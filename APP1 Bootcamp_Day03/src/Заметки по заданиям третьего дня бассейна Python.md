# Заметки по заданиям третьего дня бассейна Python

# Ex00

## Задание

Задание заключается в написании Python-скрипта, который будет модифицировать HTML-страницу (`evilcorp.html`), добавляя на неё различные элементы и изменяя существующие. В частности, нужно:

1. **Изменить заголовок страницы** (в теге `<title>`), заменив его на "Evil Corp - Stealing your money every day".
2. **Извлечь имя пользователя и его местоимение** с веб-страницы и добавить на страницу новый заголовок `<h1>`, который будет приветствовать пользователя в формате "Mr. Robot, you are hacked!" (где "Mr. Robot" — это извлечённое имя).
3. **Вставить скрипт**, который при отправке формы на странице вызовет всплывающее окно с сообщением "hacked". Этот скрипт должен быть вставлен в тег `<script>` на странице.
4. **Изменить ссылку** внизу страницы, чтобы она вела на "[https://mrrobot.fandom.com/wiki/Fsociety](https://mrrobot.fandom.com/wiki/Fsociety)", заменив название компании на "Fsociety".
5. **Сохранить результат** в новый HTML файл, назвав его `evilcorp_hacked.html`.

Цель задания — научиться работать с HTML-документами, извлекать и изменять данные с помощью Python (в данном случае, используя библиотеку BeautifulSoup), а также вставлять и модифицировать элементы страницы. Скрипт должен быть написан так, чтобы после выполнения всех изменений новая версия страницы имела заданные изменения.

### 1. **HTML и парсинг HTML в Python**:

- **HTML (HyperText Markup Language)** — стандартный язык разметки для создания веб-страниц. Работать с HTML часто приходится при написании парсеров, скрейперов и веб-приложений.
- **Beautiful Soup** — библиотека Python, которая используется для парсинга HTML и XML документов. Она предоставляет простой способ навигации, поиска и модификации дерева элементов документа. Beautiful Soup может использовать различные парсеры, включая встроенные в Python и сторонние библиотеки, такие как lxml.
- **lxml** — библиотека для работы с XML и HTML в Python. Она обеспечивает высокую производительность и поддержку как для работы с деревом DOM, так и для XPath. lxml можно использовать как бэкенд для парсинга в Beautiful Soup, чтобы объединить производительность lxml с удобным API BS4.

### 2. **Работа с Redis**:

- **Redis** — это высокопроизводительное хранилище данных в формате ключ-значение, поддерживающее различные типы данных, включая строки, списки, множества, хэш-таблицы и пр. Оно используется для кэширования, очередей сообщений и других задач, где требуется быстрая работа с данными.
- **Оптимизация Redis с помощью оберток на C** — для увеличения производительности могут использоваться низкоуровневые обертки на языке C, такие как `hiredis`. Эти обертки обеспечивают более быстрый доступ к данным, что может быть полезно при высоких нагрузках.

### 3. **Работа с YAML**:

- **YAML (YAML Ain't Markup Language)** — язык разметки, используемый для хранения конфигурационных данных в легко читаемом формате. YAML часто используется для конфигурационных файлов и сценариев автоматизации.
- **PyYAML** — популярная библиотека Python для парсинга и генерации YAML-документов. Она позволяет читать и записывать YAML-файлы, что делает её полезной при работе с конфигурацией приложений.
- **Ansible** — инструмент для автоматизации управления конфигурациями и оркестрации. Он позволяет автоматизировать развертывание приложений, управление серверами и выполнение задач конфигурации. Ansible использует YAML для написания сценариев (плейбуков), что упрощает его освоение.
- **Поддержка Ansible для Windows** — хотя Ansible изначально разрабатывался для работы с Unix-системами, он поддерживает управление Windows-серверами с использованием таких методов, как WinRM (Windows Remote Management).

### 4. **Основные понятия и применение**:

- **Парсинг бэкендов для Beautiful Soup**: Указано, что Beautiful Soup поддерживает разные парсеры, включая встроенный `html.parser`, `lxml` и `html5lib`. Эти парсеры имеют разную производительность и совместимость, где `lxml` предоставляет лучшую производительность, а `html5lib` обеспечивает наивысшую точность парсинга.
- **Ansible и работа с инфраструктурой**: Ansible полезен при работе с DevOps и администрированием, так как позволяет автоматизировать управление конфигурациями без необходимости установки агентов на управляемые узлы.

### 5. **Почему это важно**:

- **HTML и парсинг** важны для работы с веб-контентом и при написании скрейперов.
- **Redis** полезен при разработке высокопроизводительных приложений, требующих работы с данными в памяти.
- **YAML** и **Ansible** применяются в DevOps для управления конфигурациями и автоматизации задач, что делает их важными инструментами в инфраструктурном программировании.

Знание этих инструментов и технологий помогает расширить возможности разработки серверного кода, управления данными и автоматизации задач в различных сферах программирования.

### 6. Скрейпер

**Скрейпер (scraper)** — это программа или скрипт, используемый для автоматического сбора данных с веб-сайтов. Основная цель скрейпинга — извлечение информации с веб-страниц и её преобразование в удобный для использования формат, например, в таблицы, базы данных или файлы.

### Как работает скрейпер:

1. **Отправка запроса** к веб-сайту для получения его содержимого, обычно с использованием HTTP-запросов.
2. **Парсинг HTML-кода** страницы, чтобы извлечь нужную информацию. Это может включать поиск данных в конкретных HTML-тегах, таблицах, списках и других элементах страницы.
3. **Извлечение и структурирование данных** — после парсинга скрейпер извлекает целевые данные и преобразует их в формат, пригодный для последующего использования (например, CSV, JSON или база данных).

### Основные инструменты для создания скрейперов:

- **Beautiful Soup**: библиотека Python для парсинга HTML и извлечения данных.
- **lxml**: библиотека для быстрой и эффективной работы с XML и HTML.
- **Selenium**: инструмент для автоматизированного взаимодействия с веб-страницами, позволяющий обрабатывать страницы с динамическим содержимым (например, загружаемым с помощью JavaScript).
- **Scrapy**: мощный фреймворк Python для веб-скрейпинга, позволяющий создавать сложные и масштабируемые решения.

### Примеры применения скрейперов:

- **Мониторинг цен** на товары в интернет-магазинах.
- **Сбор данных** для исследований, анализа рынка или конкурентной разведки.
- **Агрегация новостей** или информации с различных сайтов.
- **Создание баз данных** контактной информации или описаний продуктов.

### Законность и этика:

Важно помнить, что использование скрейперов должно быть этическим и законным. Некоторые веб-сайты запрещают скрейпинг в своих правилах использования, и их политику следует уважать. Также рекомендуется проверять наличие **файла robots.txt**, который указывает, какие страницы разрешено сканировать, а какие — нет.

# Ex01

Задание заключается в создании двух Python скриптов — `producer.py` и `consumer.py`, которые работают с Redis pubsub, имитируя систему передачи денежных средств между пользователями.

### Основные концепты:

1. **Producer (Производитель)** генерирует JSON-сообщения, которые имитируют транзакции. Эти сообщения должны быть переданы в Redis pubsub канал. Он должен генерировать и отправлять сообщения, которые содержат информацию о транзакции:
    - **metadata** (мета-данные), включающее два поля: **from** (отправитель) и **to** (получатель), которые являются 10-значными номерами аккаунтов.
    - **amount** (сумма), которая представляет собой количество денежных средств, переведенных в рамках транзакции.
2. **Consumer (Потребитель)** слушает канал Redis и получает сообщения о транзакциях. Он должен принимать список **плохих аккаунтов** (в аргументе командной строки) и при определенных условиях менять направление транзакции:
    - Если аккаунт в списке "плохих" фигурирует как получатель (to), и сумма транзакции положительная, то отправитель и получатель должны быть поменяны местами.
    - Если сумма транзакции отрицательная, то изменения не происходят, независимо от того, кто является получателем.

### Пояснение задания:

- **Producer**:
    - Создает JSON-сообщения, где:
        - Номера аккаунтов **from** и **to** — это случайные 10-значные числа.
        - Сумма **amount** — произвольное положительное число.
    - Отправляет эти сообщения в Redis pubsub.
- **Consumer**:
    - Принимает список плохих аккаунтов через аргумент командной строки (например, `python consumer.py -e 7134456234,3476371234`).
    - Слушает Redis pubsub канал, читает сообщения и печатает их на экран.
    - Если получатель транзакции есть в списке плохих аккаунтов, и сумма положительная, то меняет местами отправителя и получателя.
    - Если сумма отрицательная, то сообщение выводится без изменений.

### Основные этапы решения:

1. **Producer (producer.py)**:
    - Используем библиотеку `redis` для подключения к Redis.
    - Генерируем случайные 10-значные номера аккаунтов для полей "from" и "to".
    - Генерируем случайное число для поля "amount".
    - Создаем JSON-сообщение с помощью библиотеки `json`.
    - Отправляем сообщение в Redis pubsub канал с помощью метода `publish`.
2. **Consumer (consumer.py)**:
    - Принимаем список плохих аккаунтов через командную строку с помощью библиотеки `argparse`.
    - Подключаемся к Redis и подписываемся на pubsub канал.
    - Читаем сообщения с помощью метода `listen`.
    - Для каждого сообщения проверяем, если получатель в списке плохих аккаунтов и сумма положительная, меняем местами отправителя и получателя.
    - Выводим сообщение в консоль.

### **JSON-сообщения**:

**JSON** (JavaScript Object Notation) — это формат обмена данными, который используется для представления структурированных данных в текстовом виде. Он широко используется для передачи данных между клиентом и сервером в веб-приложениях.

**JSON-сообщение** — это объект, записанный в формате JSON. В контексте задания это объект, который содержит определенную структуру данных, например:

```json
{
   "metadata": {
       "from": 1023461745,
       "to": 5738456434
   },
   "amount": 10000
}
```

Здесь:

- `metadata` — это вложенный объект, содержащий информацию о номерах аккаунтов отправителя и получателя.
- `amount` — сумма, передаваемая в транзакции.

### **Redis Pub/Sub канал**:

**Redis** — это система управления базами данных, в которой используется структура данных **pub/sub** (публикация/подписка). Она позволяет приложениям обмениваться сообщениями через каналы без необходимости для получателя прямо запрашивать данные у отправителя.

- **Pub/Sub** — это механизм, позволяющий одному процессу (или "производителю") отправлять сообщения в канал (публикация), а другим процессам (или "потребителям") подписываться на этот канал и получать сообщения, когда они появляются (подписка).
- В нашем случае, **producer.py** публикует сообщения в канал Redis, а **consumer.py** подписывается на этот канал и получает сообщения.

Пример работы:

1. Производитель (Producer) отправляет сообщение в канал Redis с помощью команды `r.publish('transactions', message)`.
2. Потребитель (Consumer) подписывается на этот канал с помощью `p.subscribe('transactions')` и получает сообщения, когда они публикуются.

### 3. **Мета-данные**:

**Мета-данные** — это данные, которые описывают другие данные. Они дают информацию о содержимом, но сами по себе не являются основным содержанием.

В задании **мета-данными** являются данные, которые описывают транзакцию:

```json
{
   "metadata": {
       "from": 1023461745,
       "to": 5738456434
   }
}
```

Здесь:

- `from` и `to` — это мета-данные, описывающие, кто является отправителем и получателем транзакции. Они не содержат саму информацию о денежном переводе, но указывают на стороны транзакции.

Мета-данные используются для организации, поиска и обработки основного содержимого (например, транзакции, в данном случае).

# Ex02

Задание состоит в создании скрипта на Python, который будет преобразовывать файл `todo.yml` в файл `deploy.yml` в формате YAML с использованием синтаксиса Ansible. Вот основные требования и концепты:

### Основные требования:

1. **Задачи в `todo.yml`**:
    - **Установить пакеты** — В `todo.yml` должны быть указаны пакеты, которые нужно установить на удалённом сервере.
    - **Скопировать файлы** — В `todo.yml` должны быть указаны файлы, которые нужно скопировать на сервер.
    - **Выполнить файлы** — В `todo.yml` должны быть указаны файлы, которые нужно выполнить на сервере с использованием интерпретатора Python и подходящих аргументов.
2. **Формат вывода:**
    - Скрипт должен преобразовать задачи из `todo.yml` в файл `deploy.yml` в формате YAML, который будет использовать синтаксис **Ansible** для выполнения этих задач на удалённом сервере. Это означает, что:
        - Установку пакетов следует выразить через Ansible модуль `apt` (для Debian-based систем) или `yum` (для RedHat-based систем).
        - Копирование файлов — через модуль `copy`.
        - Выполнение файлов с помощью Python — через модуль `command` или `shell`.
3. **Имя скрипта** — Скрипт должен называться `gen_ansible.py`.

### Структура и концепты:

1. **YAML** — Файлы `todo.yml` и `deploy.yml` должны быть в формате YAML, что является стандартом для конфигурации Ansible.
2. **Ansible Notation** — Использование стандартных модулей Ansible для выполнения задач:
    - `apt` или `yum` — для установки пакетов.
    - `copy` — для копирования файлов.
    - `command` или `shell` — для выполнения команд на удалённом сервере.
3. **Python для генерации YAML** — Скрипт на Python (`gen_ansible.py`) должен будет прочитать исходный `todo.yml` и создать на его основе `deploy.yml` в нужном формате.

### Что нужно сделать:

1. **Парсинг `todo.yml`**:
    - Прочитать файл `todo.yml`, в котором содержится список задач (например, установленные пакеты, файлы для копирования и для выполнения).
2. **Преобразование в Ansible Notation**:
    - Для каждой задачи в `todo.yml` создать соответствующую задачу в Ansible формате.
        - Для установки пакетов использовать модуль `apt` или `yum`.
        - Для копирования файлов — `copy`.
        - Для выполнения Python скриптов — `command` или `shell`.
3. **Генерация файла `deploy.yml`**:
    - После того как задачи будут преобразованы в нужный формат, создать файл `deploy.yml` с соответствующей структурой и заполнить его нужными данными.

### Основные концепты задания:

### 1. **YAML (YAML Ain't Markup Language)**

YAML — это читаемый человеком формат сериализации данных, который используется для хранения и обмена конфигурационными данными. Он похож на JSON, но обладает более компактным и удобочитаемым синтаксисом. YAML часто используется для конфигурационных файлов, например, в системах автоматизации, таких как Ansible, Kubernetes и других.

Пример YAML-файла:

```yaml
name: John Doe
age: 30
address:
  street: 123 Elm St
  city: Somewhere
```

Особенности:

- **Отступы** используются для обозначения уровней вложенности, что делает структуру данных легко читаемой.
- Не требует использования кавычек или скобок (как в JSON).

### 2. **Ansible**

Ansible — это инструмент для автоматизации управления конфигурациями, развертывания приложений и оркестрации. Он использует простой язык описания, основанный на YAML, для определения задач, которые должны быть выполнены на удалённых серверах. Ansible не требует установки агентов на управляемых машинах и использует SSH для подключения к ним.

Основные компоненты Ansible:

- **Playbooks** — файлы, которые описывают, что Ansible должен сделать (в формате YAML).
- **Модули** — инструменты, которые Ansible использует для выполнения конкретных задач (например, установка пакетов, копирование файлов, запуск команд).

Пример простого playbook’а:

```yaml
- name: Install and start Nginx
  hosts: webservers
  tasks:
    - name: Install Nginx
      apt:
        name: nginx
        state: present
    - name: Start Nginx
      service:
        name: nginx
        state: started
```

### 3. **Модули Ansible**

Модули Ansible — это небольшие программы, которые выполняют конкретные задачи на целевой машине. Они могут управлять файлами, пользователями, процессами, пакетами, а также взаимодействовать с внешними системами и сервисами.

### Модуль `apt`

Модуль `apt` используется для управления пакетами на системах, основанных на Debian/Ubuntu. Он позволяет устанавливать, удалять или обновлять пакеты через менеджер пакетов `apt`.

Пример использования:

```yaml
- name: Install a package
  apt:
    name: python3
    state: present
```

Здесь `state: present` означает, что пакет должен быть установлен.

### Модуль `yum`

Модуль `yum` используется для управления пакетами на системах, основанных на RedHat (например, CentOS, Fedora). Это аналог `apt` для таких систем.

Пример использования:

```yaml
- name: Install a package
  yum:
    name: httpd
    state: present
```

### Модуль `copy`

Модуль `copy` используется для копирования файлов с локальной машины на удалённый сервер.

Пример использования:

```yaml
- name: Copy file to remote server
  copy:
    src: /path/to/local/file
    dest: /path/to/remote/destination
```

Это копирует файл с локального пути в указанный путь на удалённом сервере.

### Модуль `command`

Модуль `command` используется для выполнения команд на удалённом сервере.

Пример использования:

```yaml
- name: Run a command on the remote server
  command: /usr/bin/python3 /path/to/script.py
```

Этот модуль выполняет команду (в данном случае — запуск Python скрипта).

### Модуль `shell`

Модуль `shell` аналогичен `command`, но предоставляет возможность выполнения команд с использованием оболочки (например, Bash), что позволяет использовать более сложные конструкции, такие как пайпы, перенаправления и переменные окружения.

Пример использования:

```yaml
- name: Run a shell command
  shell: "echo 'Hello World' > /tmp/hello.txt"
```

Этот модуль выполняет команду через оболочку и может включать в себя более сложные операторы.

### Резюме

- **YAML** — формат для описания данных в текстовом виде, часто используется для конфигурационных файлов.
- **Ansible** — инструмент автоматизации, который использует YAML для описания задач, которые нужно выполнить на удалённых машинах.
- **Модули Ansible** (`apt`, `yum`, `copy`, `command`, `shell`) — это инструменты, которые позволяют выполнять конкретные операции, такие как установка пакетов, копирование файлов или выполнение команд на целевых серверах.

Каждый из этих компонентов играет важную роль в автоматизации и управлении инфраструктурой с помощью Ansible

### 4. **Оркестрация**

Оркестрация — это процесс автоматизации и координации выполнения различных задач и процессов в ИТ-среде для достижения определённых целей. В контексте инфраструктуры и DevOps оркестрация используется для управления развертыванием приложений, настройкой серверов, масштабированием систем, мониторингом и выполнением других задач.

Примеры оркестрации:

- **Ansible, Kubernetes, Docker Swarm** — инструменты, которые позволяют автоматизировать развертывание приложений, управление контейнерами, настройку серверов и выполнение других операций в инфраструктуре.
- **CI/CD pipeline (конвейер разработки и развертывания)** — автоматизация процессов разработки, тестирования и развертывания приложений.

Оркестрация позволяет интегрировать различные системы, упрощать управление ими и делать процессы более эффективными.

### 5. **Пайпы (Pipes)**

В контексте командных оболочек (например, в Bash или PowerShell), **пайпы** (или каналы) — это механизм, позволяющий передавать вывод одной команды как ввод для другой команды.

Пример:

```bash
ls | grep "file"
```

Здесь:

- `ls` — выводит список файлов в текущем каталоге.
- `|` — это пайп, который передает вывод команды `ls` как ввод для команды `grep`.
- `grep "file"` — фильтрует список файлов, выводя только те, которые содержат слово "file".

Пайпы позволяют комбинировать несколько команд, создавая цепочку обработки данных.

### 6. **Перенаправления (Redirection)**

**Перенаправления** в командных оболочках позволяют направлять вывод команд в файлы или передавать ввод из файлов, а также перенаправлять ошибки. Это полезно, когда нужно сохранить вывод команд в файл, читать его из файла или обрабатывать ошибки.

Пример:

- Перенаправление вывода в файл:
    
    ```bash
    echo "Hello, World!" > output.txt
    
    ```
    
    Эта команда записывает строку "Hello, World!" в файл `output.txt`. Если файл не существует, он будет создан.
    
- Перенаправление ошибок в файл:
    
    ```bash
    command 2> error.log
    ```
    
    Это перенаправляет стандартный поток ошибок (stderr) команды в файл `error.log`.
    
- Перенаправление вывода и ошибок:
    
    ```bash
    command &> all_output.log
    ```
    
    Это перенаправляет как стандартный вывод (stdout), так и стандартные ошибки (stderr) в файл `all_output.log`.
    

### 4. **Переменные окружения**

**Переменные окружения** — это набор переменных, которые хранят информацию о системе и её состоянии, доступную для всех процессов в операционной системе. Эти переменные содержат важную информацию, такую как путь к директориям, настройки и параметры для приложений и команд.

Примеры переменных окружения:

- `PATH` — список директорий, где операционная система ищет исполнимые файлы.
- `HOME` — домашний каталог текущего пользователя.
- `USER` — имя текущего пользователя.

Пример использования переменной окружения в командной строке:

```bash
echo $HOME
```

Эта команда выведет путь к домашнему каталогу текущего пользователя.

Переменные окружения могут быть установлены для целых сессий или для отдельных процессов. Они играют важную роль в настройке работы программ и систем.

### Резюме:

- **Оркестрация** — автоматизация координации и управления различными процессами и задачами в инфраструктуре.
- **Пайпы** — механизм передачи вывода одной команды как ввода для другой команды в командных оболочках.
- **Перенаправления** — возможность направлять вывод или ошибки команд в файлы или принимать ввод из файлов.
- **Переменные окружения** — системные переменные, доступные всем процессам, которые содержат важную информацию о системе и её настройках.

Эти концепты помогают улучшить управление операциями в командной строке, в системах автоматизации и оркестрации, а также в процессе разработки и эксплуатации приложений.

### 5. Установка библиотеки Ansible

Ошибка `externally-managed-environment` возникает из-за того, что ваш Python управляется Homebrew, и он запрещает установку системных пакетов с помощью `pip`, чтобы избежать повреждения системного окружения.

---

### **Использование виртуального окружения (`venv`)**

Это наиболее безопасный и рекомендуемый способ установки Python-пакетов. Виртуальное окружение изолирует зависимости, не вмешиваясь в системный Python.

1. Создайте виртуальное окружение:
    
    ```bash
    python3 -m venv ~/ansible_env
    ```
    
2. Активируйте виртуальное окружение:
    
    ```bash
    source ~/ansible_env/bin/activate
    ```
    
3. Установите Ansible:
    
    ```bash
    pip install ansible
    ```
    
4. Проверьте, что Ansible установлен:
    
    ```bash
    ansible --version
    ```
    
5. После завершения работы с Ansible вы можете отключить виртуальное окружение:
    
    ```bash
    deactivate
    ```
    

### 6. Запуск программы и проверка работы

python3 gen_ansible.py

ansible-playbook -i inventory.ini deploy.yml -v